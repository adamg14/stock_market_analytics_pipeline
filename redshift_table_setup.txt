CREATE TABLE stock_prices (
    ticker VARCHAR(10) NOT NULL,
    "interval" VARCHAR(10) NOT NULL,
    currency VARCHAR(10) NOT NULL,
    exchange_timezone VARCHAR(50) NOT NULL,
    exchange VARCHAR(50) NOT NULL,
    date_timestamp TIMESTAMP NOT NULL,
    open_price FLOAT NOT NULL,
    high FLOAT NOT NULL,
    low FLOAT NOT NULL,
    close FLOAT NOT NULL,
    volume BIGINT NOT NULL,
    processing_time TIMESTAMP NOT NULL
)

CREATE TABLE public.stock_prices_unique AS
SELECT 
	ticker,
    interval,
    currency,
    exchange_timezone,
    exchange,
    date_timestamp,
    open_price,
    high,
    low,
    close,
    volume,
    processing_time
FROM (
  SELECT
  	*,
  	ROW_NUMBER() OVER(
      PARTITION BY ticker, date_timestamp
    ORDER BY processing_time ASC) AS row_num
  FROM public.stock_prices
)
WHERE row_num = 1